<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Tabela de Notas</title>
</head>
<body>
  <table id="tabelaNotas" border="1">
    <caption>Tabela de Notas</caption>
    <thead>
      <tr>
        <th rowspan="2">Nome do Aluno</th>
        <th colspan="3">1º Semestre</th>
        <th colspan="3">2º Semestre</th>
        <th colspan="3">3º Semestre</th>
        <th rowspan="2" id="colMediaTitulo"></th> 
      </tr>
      <tr>
        <th>Nota 1</th>
        <th>Nota 2</th>
        <th>Nota 3</th>
        <th>Nota 1</th>
        <th>Nota 2</th>
        <th>Nota 3</th>
        <th>Nota 1</th>
        <th>Nota 2</th>
        <th>Nota 3</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>João</td>
        <td>8.0</td>
        <td>7.5</td>
        <td>9.0</td>
        <td>6.5</td>
        <td>8.0</td>
        <td>7.0</td>
        <td>9.5</td>
        <td>8.5</td>
        <td>9.0</td>
      </tr>
      <tr>
        <td>Maria</td>
        <td>7.0</td>
        <td>8.0</td>
        <td>7.5</td>
        <td>9.0</td>
        <td>8.5</td>
        <td>9.5</td>
        <td>6.0</td>
        <td>7.5</td>
        <td>8.0</td>
      </tr>
    </tbody>
  </table>

  <br>
  <button onclick="calcularMediasColunas()">Calcular Médias (por nota)</button>
  <button onclick="calcularMediasLinhas()">Calcular Médias (por aluno)</button>

  <script>
    // === MÉDIA POR COLUNA (já corrigido da versão anterior) ===
    function calcularMediasColunas() {
      let tabela = document.getElementById("tabelaNotas");
      let linhas = tabela.tBodies[0].rows;
      let qtdAlunos = linhas.length;

      let numColunasNotas = linhas[0].cells.length - 1; // -1 porque a 1ª é nome
      let somas = new Array(numColunasNotas).fill(0);

      for (let i = 0; i < qtdAlunos; i++) {
        for (let j = 1; j <= numColunasNotas; j++) {
          somas[j - 1] += parseFloat(linhas[i].cells[j].innerText);
        }
      }

      // remove linha anterior se já existir
      let ultima = tabela.tBodies[0].lastElementChild;
      if (ultima && ultima.cells[0].innerText === "Média") {
        tabela.tBodies[0].removeChild(ultima);
      }

      let novaLinha = tabela.tBodies[0].insertRow();
      novaLinha.insertCell().innerHTML = "<b>Média</b>";

      for (let i = 0; i < numColunasNotas; i++) {
        let media = somas[i] / qtdAlunos;
        novaLinha.insertCell().innerText = media.toFixed(1);
      }

      // se existir coluna de médias por aluno, deixar um espaço vazio
      if (document.getElementById("colMediaTitulo").innerText === "Média do Aluno") {
        novaLinha.insertCell().innerText = "—";
      }
    }

    // === MÉDIA POR LINHA (cada aluno) ===
    function calcularMediasLinhas() {
      let tabela = document.getElementById("tabelaNotas");
      let linhas = tabela.tBodies[0].rows;
      let qtdAlunos = linhas.length;

      let numColunasNotas = linhas[0].cells.length - 1; // -1 porque a 1ª é nome

      // se já existe a coluna, não recria
      let cabecalho = document.getElementById("colMediaTitulo");
      if (cabecalho.innerText !== "Média do Aluno") {
        cabecalho.innerText = "Média do Aluno";
      }

      for (let i = 0; i < qtdAlunos; i++) {
        let soma = 0;
        for (let j = 1; j <= numColunasNotas; j++) {
          soma += parseFloat(linhas[i].cells[j].innerText);
        }
        let media = soma / numColunasNotas;

        // se a linha já tiver a célula de média, só atualiza
        if (linhas[i].cells.length > numColunasNotas + 1) {
          linhas[i].cells[numColunasNotas + 1].innerText = media.toFixed(1);
        } else {
          linhas[i].insertCell().innerText = media.toFixed(1);
        }
      }

      // se a linha de médias já existir, garante que ela tenha uma célula no final
      let ultima = tabela.tBodies[0].lastElementChild;
      if (ultima.cells[0].innerText === "Média") {
        if (ultima.cells.length <= numColunasNotas) {
          ultima.insertCell().innerText = "—";
        }
      }
    }
  </script>
</body>
</html>
